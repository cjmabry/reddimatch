{% extends "base.html" %}
{% block container%}container-fluid{% endblock %}
{% block page_class%}class="messages"{% endblock %}
{% block content %}
{% with matches = current_user.get_matches() %}
<!-- TODO refactor to be in line with new chat.js -->

  <div id="messages" class="row">

    <div id="conversations" class="pull-left">

        {% if matches.count() > 0 %}

          <ul id="user_list">

          {% for match in matches %}

            {% if loop.index == 1 %}

            <li class="user selected" data-username="{{ match.username }}">

              <div class="profile_photo">

                <img src="{{ match.avatar(60) }}">

              </div>
              <div class="info">

                <span class="username">{{match.username}}</span>

                <!-- <span class="time">Just Now</span> -->

              </div>

              <div class="right_side">
                <div class="status"></div>

                <div class="expand text-center glyphicon glyphicon-chevron-right"></div>
              </div>

            </li>

            {% else %}

            <li class="user" data-username="{{ match.username }}">

              <div class="profile_photo">

                <img src="{{ match.avatar(60) }}">

              </div>
              <div class="info">

                <span class="username">{{match.username}}</span>

                <!-- <span class="time">Just Now</span> -->

              </div>

              <div class="right_side">
                <div class="status"></div>

                <div class="expand text-center glyphicon glyphicon-chevron-right"></div>
              </div>

            </li>

            {% endif %}

          {% endfor %}

          </ul>

          <div class="find_another hidden-xs">
            <a href="{{url_for('match')}}" class='btn btn-primary'>Find another match<span class="glyphicon glyphicon glyphicon-chevron-right"></span></a>
          </div>

        {% else %}

        <!--  No matches -->

        {% endif %}

    </div>

    <div id="current_conversation">

      <div id="current_messages"></div>

      <div id="chat_box">

        <textarea id="enter_message" placeholder="Type a message..." contenteditable="true" rows="1"></textarea>
        <span id="submit_message" class="text-center glyphicon glyphicon-send"></span>

      </div>

    </div>

    <div id="user_info">

      {% if matches.count() > 0 %}

        <div class="card current_user">

            <div class="profile_photo"></div>
            <div class="info">

              <div class="wrapper">
                <span id="conversation_heading" class="username"></span>
                <span class="age"></span>
                <span class="gender"></span>
                <span class="location"></span>
              </div>

            </div>

          </div>

          <div class="card">

            <h5>Favorite Subreddits</h5>

            <div class="favorite_subs">
              <span class="badge"></span>
              <span class="badge"></span>
              <span class="badge"></span>
            </div>

          </div>

      {% endif %}

      <!-- <div class="card">

        <h5>Mutual Subreddits</h5>

        <div class="mutual_subs">
          <span class="badge">/r/animals</span>
          <span class="badge">/r/animals</span>
          <span class="badge">/r/animals</span>
        </div>

      </div> -->

    </div>

  </div>

{% endwith %}


{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{{url_for('static', filename='js/vendor/socket.io-1.3.7.js')}}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/custom/chat.js')}}"></script>
{% endblock %}
